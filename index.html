<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEMPO Mission | Air Quality Forecast</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111;
            color: #e0e0e0;
            overflow: hidden; /* Prevent vertical scroll */
        }
        .horizontal-scroll-container {
            display: flex;
            width: 600vw; /* 100vw per section (6 sections) */
            height: 100vh;
            will-change: transform;
            transition: transform 0.8s cubic-bezier(0.65, 0, 0.35, 1);
        }
        .scroll-section {
            width: 100vw;
            height: 100vh;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            position: relative;
        }
        .hero-bg {
            background-image: url('https://images.unsplash.com/photo-1506704433933-45416b71858a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto-format=fit=crop&w=1974&q=80');
            background-size: cover;
            background-position: center;
            position: absolute;
            inset: 0;
            filter: grayscale(100%);
        }
        .card {
            background: #1a1a1a;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Animation for content fade-in */
        .animated-item {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .scroll-section.is-visible .animated-item {
            opacity: 1;
            transform: translateY(0);
        }
        .scroll-section.is-visible .animated-item:nth-child(2) { transition-delay: 0.2s; }
        .scroll-section.is-visible .animated-item:nth-child(3) { transition-delay: 0.4s; }
        .scroll-section.is-visible .animated-item:nth-child(4) { transition-delay: 0.6s; }
        .scroll-section.is-visible .animated-item:nth-child(5) { transition-delay: 0.8s; }

        /* AQI Colors */
        .aqi-good { color: #4ade80; }
        .aqi-moderate { color: #facc15; }
        .aqi-unhealthy-sensitive { color: #fb923c; }
        .aqi-unhealthy { color: #f87171; }
        .aqi-very-unhealthy { color: #c084fc; }
        .aqi-hazardous { color: #f472b6; }
        
        /* Health Risk Tabs */
        .health-tab {
            background-color: transparent;
            border: 1px solid #4b5563;
            color: #d1d5db;
            transition: all 0.2s ease;
        }
        .health-tab:hover {
            background-color: #374151;
        }
        .health-tab.active {
            background-color: #fff;
            color: #111;
            border-color: #fff;
        }
        
        #wind-pointer {
            transition: transform 0.5s ease-out;
        }
    </style>
</head>
<body>

    <div class="horizontal-scroll-container">
        <!-- Section 1: Hero -->
        <section class="scroll-section">
            <div class="hero-bg"></div>
            <div class="absolute inset-0 bg-black/70"></div>
            <div class="relative z-10 text-center">
                <h1 class="text-6xl md:text-9xl font-black uppercase text-white animated-item">Aura</h1>
                <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-300 animated-item">Real-time air quality forecasts powered by NASA's TEMPO mission.</p>
            </div>
            <div class="absolute bottom-10 text-white text-sm animate-bounce">Scroll to Explore</div>
        </section>

        <!-- Section 2: Location & AQI -->
        <section class="scroll-section">
            <div class="w-full max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="animated-item">
                    <h2 class="text-5xl md:text-7xl font-black text-white uppercase">Select Location</h2>
                    <select id="city-select" class="w-full mt-6 bg-[#1a1a1a] border border-gray-700 text-white rounded-lg p-4 text-xl focus:ring-2 focus:ring-white focus:border-white"></select>
                </div>
                <div class="card rounded-2xl p-8 text-center animated-item">
                    <h3 id="city-name" class="text-3xl font-bold text-white">--</h3>
                    <p class="text-sm text-gray-400 mt-6">REAL-TIME AIR QUALITY INDEX (AQI)</p>
                    <p id="aqi-value" class="text-8xl md:text-9xl font-black transition-colors">--</p>
                    <p id="aqi-level" class="text-2xl font-bold transition-colors">--</p>
                </div>
            </div>
        </section>

        <!-- Section 3: Insights & Briefing -->
        <section class="scroll-section">
             <div class="w-full max-w-7xl mx-auto space-y-8">
                <div class="card rounded-2xl p-6 text-center animated-item">
                    <h4 class="font-bold text-white uppercase text-sm">Local Time</h4>
                    <p id="local-time" class="text-5xl font-black text-white mt-2">--:--:--</p>
                </div>
                <div class="card rounded-2xl p-8 animated-item">
                    <h4 class="font-bold text-white text-xl">Health Advisory</h4>
                    <p id="advisory-text" class="text-gray-400 mt-2 min-h-[4.5rem]">Select a city to view the advisory.</p>
                </div>
                <div class="card rounded-2xl p-8 grid grid-cols-1 md:grid-cols-3 gap-8 text-center animated-item">
                    <div>
                        <h4 class="font-bold text-white">Go Outside?</h4>
                        <p id="outside-recommendation" class="text-4xl font-bold mt-2">--</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-white">Best Time to Go Out</h4>
                        <p id="best-time" class="text-4xl font-bold mt-2">--</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-white">Sensitive Groups</h4>
                        <p id="sensitive-group-advice" class="text-lg mt-2 text-gray-300">--</p>
                    </div>
                </div>
             </div>
        </section>
        
        <!-- Section 4: Current Weather Details -->
        <section class="scroll-section">
            <div class="w-full max-w-7xl mx-auto">
                <h2 class="text-5xl md:text-7xl font-black text-white uppercase text-center animated-item">Current Conditions</h2>
                <div class="card rounded-2xl p-8 grid grid-cols-1 md:grid-cols-2 gap-8 mt-8 animated-item">
                    <!-- Left Side: Data List -->
                    <div class="space-y-6">
                        <div class="flex justify-between items-baseline border-b border-gray-700 pb-2">
                            <span class="text-gray-400">Temperature</span>
                            <span id="temp-value" class="text-3xl font-bold">--°C</span>
                        </div>
                        <div class="flex justify-between items-baseline border-b border-gray-700 pb-2">
                            <span class="text-gray-400">Humidity</span>
                            <span id="humidity-value" class="text-3xl font-bold">--%</span>
                        </div>
                        <div class="flex justify-between items-baseline border-b border-gray-700 pb-2">
                            <span class="text-gray-400">UV Index</span>
                            <div>
                                <span id="uv-value" class="text-3xl font-bold">--</span>
                                <span id="uv-description" class="text-sm text-gray-500 ml-2">--</span>
                            </div>
                        </div>
                         <div class="flex justify-between items-baseline border-b border-gray-700 pb-2">
                            <span class="text-gray-400">Visibility</span>
                             <div>
                                <span id="visibility-value" class="text-3xl font-bold">-- km</span>
                                <span id="visibility-description" class="text-sm text-gray-500 ml-2">--</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-baseline border-b border-gray-700 pb-2">
                            <span class="text-gray-400">Pressure</span>
                            <span id="pressure-value" class="text-3xl font-bold">-- mb</span>
                        </div>
                    </div>
                    <!-- Right Side: Wind Compass -->
                    <div class="flex flex-col items-center justify-center">
                        <h4 class="font-bold text-white text-center mb-4">Wind</h4>
                        <div class="relative w-40 h-40">
                            <svg viewBox="0 0 100 100" class="w-full h-full">
                                <circle cx="50" cy="50" r="48" stroke="#4b5563" stroke-width="2" fill="none" />
                                <text x="50" y="12" text-anchor="middle" font-size="8" fill="#d1d5db">N</text>
                                <text x="50" y="94" text-anchor="middle" font-size="8" fill="#d1d5db">S</text>
                                <text x="6" y="54" text-anchor="middle" font-size="8" fill="#d1d5db">W</text>
                                <text x="94" y="54" text-anchor="middle" font-size="8" fill="#d1d5db">E</text>
                                <polygon id="wind-pointer" points="50,15 45,50 55,50" fill="#4ade80" transform-origin="50 50" />
                            </svg>
                        </div>
                        <div class="text-center mt-4">
                            <p id="wind-speed" class="text-2xl font-bold">-- km/h</p>
                            <p id="wind-gust" class="text-sm text-gray-400">Gusts: -- km/h</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 5: Forecasts -->
        <section class="scroll-section">
            <div class="w-full max-w-7xl mx-auto space-y-8">
                <h2 class="text-5xl md:text-7xl font-black text-white uppercase text-center animated-item">Forecasts</h2>
                <div class="card rounded-xl p-6 animated-item">
                    <h3 class="font-bold text-white mb-4">Hourly Temperature Forecast (24h)</h3>
                    <canvas id="hourly-chart"></canvas>
                </div>
                <div id="weekly-forecast-grid" class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-4 text-center animated-item"></div>
            </div>
        </section>

        <!-- Section 6: Health Education -->
        <section class="scroll-section">
            <div class="w-full max-w-7xl mx-auto">
                <h2 class="text-5xl md:text-7xl font-black text-white uppercase text-center animated-item">Understand Your Risks</h2>
                <div id="education-tabs" class="flex flex-wrap justify-center gap-3 my-8 animated-item">
                    <button class="health-tab px-4 py-2 rounded-full font-bold" data-condition="copd">Chronic (COPD)</button>
                    <button class="health-tab px-4 py-2 rounded-full font-bold" data-condition="asthma">Asthma</button>
                    <button class="health-tab px-4 py-2 rounded-full font-bold" data-condition="heart">Heart Issues</button>
                    <button class="health-tab px-4 py-2 rounded-full font-bold" data-condition="allergies">Allergies</button>
                </div>
                <div class="card rounded-2xl p-8 grid grid-cols-1 md:grid-cols-3 gap-8 items-center animated-item">
                    <div class="text-center md:text-left">
                        <svg class="w-32 h-32 mx-auto md:mx-0 text-gray-500" viewBox="0 0 512 512" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M368 48c-26.5 0-48 21.5-48 48v288c0 26.5 21.5 48 48 48h48c26.5 0 48-21.5 48-48V96c0-26.5-21.5-48-48-48h-48zm-224 0c-26.5 0-48 21.5-48 48v288c0 26.5 21.5 48 48 48h48c26.5 0 48-21.5 48-48V96c0-26.5-21.5-48-48-48h-48zM96 96c-53 0-96 43-96 96v128c0 53 43 96 96 96h16c8.8 0 16-7.2 16-16s-7.2-16-16-16H96c-35.3 0-64-28.7-64-64V192c0-35.3 28.7-64 64-64h16c8.8 0 16-7.2 16-16s-7.2-16-16-16H96zm320 0c-53 0-96 43-96 96v128c0 53 43 96 96 96h16c8.8 0 16-7.2 16-16s-7.2-16-16-16h-16c-35.3 0-64-28.7-64-64V192c0-35.3 28.7-64 64-64h16c8.8 0 16-7.2 16-16s-7.2-16-16-16h-16z"/></svg>
                        <p id="risk-level-badge" class="mt-4 px-3 py-1 rounded-full font-bold inline-block">--</p>
                    </div>
                    <div class="md:col-span-2">
                        <h3 id="condition-title" class="text-3xl font-bold text-white mb-2"></h3>
                        <p id="risk-description" class="mb-4 text-gray-300"></p>
                        <p id="symptom-description" class="mb-6 text-gray-400 text-sm"></p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-bold text-white mb-2">Do's</h4>
                                <ul id="dos-list" class="space-y-2 text-sm"></ul>
                            </div>
                            <div>
                                <h4 class="font-bold text-white mb-2">Don'ts</h4>
                                <ul id="donts-list" class="space-y-2 text-sm"></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const OWM_API_KEY = "895284fb2d2c50a520ea537456963d9c";
            const cityData = {
                "New York, NY": { lat: 40.7128, lon: -74.0060, timezone: "America/New_York" },
                "Los Angeles, CA": { lat: 34.0522, lon: -118.2437, timezone: "America/Los_Angeles" },
                "Chicago, IL": { lat: 41.8781, lon: -87.6298, timezone: "America/Chicago" },
                "Houston, TX": { lat: 29.7604, lon: -95.3698, timezone: "America/Chicago" },
                "Phoenix, AZ": { lat: 33.4484, lon: -112.0740, timezone: "America/Phoenix" },
                "Philadelphia, PA": { lat: 39.9526, lon: -75.1652, timezone: "America/New_York" },
                "San Antonio, TX": { lat: 29.4241, lon: -98.4936, timezone: "America/Chicago" },
                "San Diego, CA": { lat: 32.7157, lon: -117.1611, timezone: "America/Los_Angeles" },
                "Dallas, TX": { lat: 32.7767, lon: -96.7970, timezone: "America/Chicago" },
                "San Jose, CA": { lat: 37.3382, lon: -121.8863, timezone: "America/Los_Angeles" },
                "Austin, TX": { lat: 30.2672, lon: -97.7431, timezone: "America/Chicago" },
                "Jacksonville, FL": { lat: 30.3322, lon: -81.6557, timezone: "America/New_York" },
                "San Francisco, CA": { lat: 37.7749, lon: -122.4194, timezone: "America/Los_Angeles" },
                "Indianapolis, IN": { lat: 39.7684, lon: -86.1581, timezone: "America/Indiana/Indianapolis" },
                "Seattle, WA": { lat: 47.6062, lon: -122.3321, timezone: "America/Los_Angeles" },
                "Denver, CO": { lat: 39.7392, lon: -104.9903, timezone: "America/Denver" },
                "Washington, DC": { lat: 38.9072, lon: -77.0369, timezone: "America/New_York" },
                "Boston, MA": { lat: 42.3601, lon: -71.0589, timezone: "America/New_York" },
                "Detroit, MI": { lat: 42.3314, lon: -83.0458, timezone: "America/Detroit" },
                "Nashville, TN": { lat: 36.1627, lon: -86.7816, timezone: "America/Chicago" },
                "Portland, OR": { lat: 45.5051, lon: -122.6750, timezone: "America/Los_Angeles" },
                "Las Vegas, NV": { lat: 36.1699, lon: -115.1398, timezone: "America/Los_Angeles" },
                "Miami, FL": { lat: 25.7617, lon: -80.1918, timezone: "America/New_York" },
                "Atlanta, GA": { lat: 33.7490, lon: -84.3880, timezone: "America/New_York" },
            };
            
            const educationData = {
                copd: {
                    title: "Chronic (COPD)",
                    symptoms: "Mild symptoms: slight shortness of breath, occasional wheezing, and low-grade fatigue.",
                    dos: ["Stay informed about AQI levels.", "Stay hydrated to keep airways clear.", "Incorporate antioxidant-rich foods."],
                    donts: ["Neglect regular exercise.", "Expose yourself to smoke.", "Skip prescribed medications."],
                    riskMapping: { Good: { text: "Low Risk", color: "bg-green-500 text-white" }, Moderate: { text: "Moderate Risk", color: "bg-yellow-500 text-black" }, "Unhealthy (SG)": { text: "High Risk", color: "bg-orange-500 text-white" }, Unhealthy: { text: "High Risk", color: "bg-red-500 text-white" }, "Very Unhealthy": { text: "Very High Risk", color: "bg-purple-500 text-white" }, Hazardous: { text: "Very High Risk", color: "bg-purple-500 text-white" } }
                },
                asthma: {
                    title: "Asthma",
                    symptoms: "Symptoms may include coughing, wheezing, shortness of breath, and chest tightness.",
                    dos: ["Keep rescue inhaler nearby.", "Avoid known triggers.", "Use an indoor air purifier."],
                    donts: ["Forget to monitor symptoms.", "Engage in strenuous outdoor activity on high AQI days.", "Skip your controller medication."],
                     riskMapping: { Good: { text: "Low Risk", color: "bg-green-500 text-white" }, Moderate: { text: "Moderate Risk", color: "bg-yellow-500 text-black" }, "Unhealthy (SG)": { text: "High Risk", color: "bg-orange-500 text-white" }, Unhealthy: { text: "High Risk", color: "bg-red-500 text-white" }, "Very Unhealthy": { text: "Very High Risk", color: "bg-purple-500 text-white" }, Hazardous: { text: "Very High Risk", color: "bg-purple-500 text-white" } }
                },
                heart: {
                    title: "Heart Issues",
                    symptoms: "Pollution can cause chest pain, palpitations, shortness of breath, and fatigue.",
                    dos: ["Monitor blood pressure.", "Take medications as prescribed.", "Eat a heart-healthy diet."],
                    donts: ["Overexert yourself outdoors.", "Ignore symptoms like chest pain.", "Consume excessive sodium."],
                     riskMapping: { Good: { text: "Low Risk", color: "bg-green-500 text-white" }, Moderate: { text: "Low Risk", color: "bg-green-500 text-white" }, "Unhealthy (SG)": { text: "Moderate Risk", color: "bg-yellow-500 text-black" }, Unhealthy: { text: "High Risk", color: "bg-red-500 text-white" }, "Very Unhealthy": { text: "High Risk", color: "bg-red-500 text-white" }, Hazardous: { text: "Very High Risk", color: "bg-purple-500 text-white" } }
                },
                allergies: {
                    title: "Allergies",
                    symptoms: "High pollution can worsen allergy symptoms like sneezing, runny nose, and itchy eyes.",
                    dos: ["Keep windows closed on high pollen/pollution days.", "Use HEPA filters at home.", "Rinse sinuses after being outdoors."],
                    donts: ["Forget to check pollen counts.", "Dry laundry outside.", "Neglect allergy medication."],
                     riskMapping: { Good: { text: "Low Risk", color: "bg-green-500 text-white" }, Moderate: { text: "Moderate Risk", color: "bg-yellow-500 text-black" }, "Unhealthy (SG)": { text: "Moderate Risk", color: "bg-yellow-500 text-black" }, Unhealthy: { text: "High Risk", color: "bg-red-500 text-white" }, "Very Unhealthy": { text: "High Risk", color: "bg-red-500 text-white" }, Hazardous: { text: "Very High Risk", color: "bg-purple-500 text-white" } }
                }
            };

            const citySelect = document.getElementById('city-select');
            const cityNameEl = document.getElementById('city-name');
            const aqiValueEl = document.getElementById('aqi-value');
            const aqiLevelEl = document.getElementById('aqi-level');
            const advisoryTextEl = document.getElementById('advisory-text');
            const tempValueEl = document.getElementById('temp-value');
            const humidityValueEl = document.getElementById('humidity-value');
            const windValueEl = document.getElementById('wind-value');
            const uvValueEl = document.getElementById('uv-value');
            const weeklyForecastGrid = document.getElementById('weekly-forecast-grid');
            const outsideRecommendationEl = document.getElementById('outside-recommendation');
            const bestTimeEl = document.getElementById('best-time');
            const sensitiveGroupAdviceEl = document.getElementById('sensitive-group-advice');
            const localTimeEl = document.getElementById('local-time');
            
            const educationTabsContainer = document.getElementById('education-tabs');
            const riskLevelBadgeEl = document.getElementById('risk-level-badge');
            const conditionTitleEl = document.getElementById('condition-title');
            const riskDescriptionEl = document.getElementById('risk-description');
            const symptomDescriptionEl = document.getElementById('symptom-description');
            const dosListEl = document.getElementById('dos-list');
            const dontsListEl = document.getElementById('donts-list');
            
            const uvDescriptionEl = document.getElementById('uv-description');
            const visibilityValueEl = document.getElementById('visibility-value');
            const visibilityDescriptionEl = document.getElementById('visibility-description');
            const pressureValueEl = document.getElementById('pressure-value');
            const windPointer = document.getElementById('wind-pointer');
            const windSpeedEl = document.getElementById('wind-speed');
            const windGustEl = document.getElementById('wind-gust');

            let hourlyChart;
            let currentAqiData = { aqi: 0, level: 'Good' };
            let clockInterval;
            let activeCondition = 'copd';

            // --- Horizontal Scroll & Animation Logic ---
            const scrollContainer = document.querySelector('.horizontal-scroll-container');
            const sections = document.querySelectorAll('.scroll-section');
            let currentSection = 0;
            let isScrolling = false;
            
            function handleScroll(e) {
                if (isScrolling) return;
                isScrolling = true;
                if (e.deltaY > 0 && currentSection < sections.length - 1) { currentSection++; } 
                else if (e.deltaY < 0 && currentSection > 0) { currentSection--; }
                scrollContainer.style.transform = `translateX(-${currentSection * 100}vw)`;
                sections.forEach((section, index) => { if(index === currentSection) { section.classList.add('is-visible'); } });
                setTimeout(() => { isScrolling = false; }, 1000);
            }
            window.addEventListener('wheel', handleScroll);
            sections[0].classList.add('is-visible');

            // --- Helper Functions ---
            function getAqiDetails(aqi) {
                if (aqi <= 50) return { level: "Good", colorClass: "aqi-good", sensitive: "No restrictions.", advisory: "Air quality is excellent. A great day for outdoor activities!" };
                if (aqi <= 100) return { level: "Moderate", colorClass: "aqi-moderate", sensitive: "Unusually sensitive people should consider reducing prolonged exertion.", advisory: "Air quality is acceptable. Most people can enjoy the outdoors."};
                if (aqi <= 150) return { level: "Unhealthy (SG)", colorClass: "aqi-unhealthy-sensitive", sensitive: "Limit prolonged outdoor exertion.", advisory: "Sensitive groups may experience health effects. The general public is less likely to be affected."};
                if (aqi <= 200) return { level: "Unhealthy", colorClass: "aqi-unhealthy", sensitive: "Avoid prolonged outdoor exertion.", advisory: "Everyone may begin to experience some health effects. It's best to limit outdoor exertion."};
                if (aqi <= 300) return { level: "Very Unhealthy", colorClass: "aqi-very-unhealthy", sensitive: "Remain indoors and keep activity levels low.", advisory: "Health alert: everyone may experience more serious health effects. Avoid all outdoor activities."};
                return { level: "Hazardous", colorClass: "aqi-hazardous", sensitive: "Remain indoors.", advisory: "Health warning of emergency conditions. The entire population is more likely to be affected. Stay indoors."};
            }
            
            // --- Data Fetching ---
            async function fetchAirQualityForecast(lat, lon) {
                 try {
                    const response = await fetch(`https://api.openweathermap.org/data/2.5/air_pollution/forecast?lat=${lat}&lon=${lon}&appid=${OWM_API_KEY}`);
                    const data = await response.json();
                    const calcAqiFromPm25 = (pm25) => {
                        if (pm25 > 350.5) return 401 + (pm25 - 350.5) * (99 / 149.9);
                        if (pm25 > 250.5) return 301 + (pm25 - 250.5) * (99 / 99.9);
                        if (pm25 > 150.5) return 201 + (pm25 - 150.5) * (99 / 99.9);
                        if (pm25 > 55.5) return 151 + (pm25 - 55.5) * (49 / 94.9);
                        if (pm25 > 35.5) return 101 + (pm25 - 35.5) * (49 / 19.9);
                        if (pm25 > 12.1) return 51 + (pm25 - 12.1) * (49 / 23.3);
                        return Math.round((pm25 / 12) * 50);
                    };
                    const currentAqi = calcAqiFromPm25(data.list[0].components.pm2_5);
                    const hourlyAqi = data.list.map(item => calcAqiFromPm25(item.components.pm2_5));
                    return { currentAqi, hourlyAqi };
                } catch (error) { 
                    const randomAqi = Math.floor(Math.random() * 150) + 20;
                    const hourlyAqi = Array(24).fill(0).map(() => Math.max(0, Math.round(randomAqi + (Math.random() - 0.5) * 20)));
                    return { currentAqi: randomAqi, hourlyAqi };
                }
            }
            async function fetchWeatherAndForecast(lat, lon) {
                 try {
                    const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,wind_speed_10m,wind_direction_10m,uv_index,visibility,surface_pressure,wind_gusts_10m&hourly=temperature_2m&daily=temperature_2m_max,temperature_2m_min&timezone=auto`);
                    return await response.json();
                } catch (error) { console.error("Weather API failed", error); return null; }
            }
            
            function updateClock(timezone) {
                if (clockInterval) clearInterval(clockInterval);
                clockInterval = setInterval(() => {
                    const now = new Date();
                    const timeString = now.toLocaleTimeString('en-US', { timeZone: timezone, hour: '2-digit', minute: '2-digit', hour12: true });
                    localTimeEl.textContent = timeString;
                }, 1000);
            }

            function updateWeatherUI(weather) {
                if (!weather) return;
                
                tempValueEl.textContent = `${Math.round(weather.current.temperature_2m)}°C`;
                humidityValueEl.textContent = `${weather.current.relative_humidity_2m}%`;
                uvValueEl.textContent = weather.current.uv_index.toFixed(1);
                uvDescriptionEl.textContent = getUvDescription(weather.current.uv_index);
                visibilityValueEl.textContent = `${(weather.current.visibility / 1000).toFixed(1)}`;
                visibilityDescriptionEl.textContent = getVisibilityDescription(weather.current.visibility);
                pressureValueEl.textContent = `${Math.round(weather.current.surface_pressure)}`;
                
                windSpeedEl.textContent = `${Math.round(weather.current.wind_speed_10m)} km/h`;
                windGustEl.textContent = `Gusts: ${Math.round(weather.current.wind_gusts_10m)} km/h`;
                windPointer.style.transform = `rotate(${weather.current.wind_direction_10m}deg)`;

                const hourlyLabels = weather.hourly.time.slice(0, 24).map(t => new Date(t).getHours());
                const hourlyTemps = weather.hourly.temperature_2m.slice(0, 24);
                const chartData = {
                    labels: hourlyLabels.map(h => `${h}:00`),
                    datasets: [{ label: 'Temp (°C)', data: hourlyTemps, borderColor: '#fff', backgroundColor: 'rgba(255, 255, 255, 0.2)', fill: true, tension: 0.4 }]
                };
                 const chartOptions = {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#a0a0a0' } },
                        x: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#a0a0a0' } }
                    }
                };
                
                if(hourlyChart) { hourlyChart.data = chartData; hourlyChart.options = chartOptions; hourlyChart.update(); }
                else {
                    const ctx = document.getElementById('hourly-chart').getContext('2d');
                    hourlyChart = new Chart(ctx, { type: 'line', data: chartData, options: chartOptions });
                }
            }
            
            function getUvDescription(uvIndex) {
                if (uvIndex <= 2) return "Low"; if (uvIndex <= 5) return "Moderate";
                if (uvIndex <= 7) return "High"; if (uvIndex <= 10) return "Very High";
                return "Extreme";
            }
            function getVisibilityDescription(meters) {
                const km = meters / 1000;
                if (km > 10) return "Excellent"; if (km > 5) return "Good";
                if (km > 2) return "Moderate"; return "Poor";
            }

            function updateActivityBriefing(aqi, weather, hourlyAqi) {
                if (aqi <= 100 && weather.current.uv_index < 8) {
                    outsideRecommendationEl.textContent = "Yes";
                    outsideRecommendationEl.className = "text-4xl font-bold mt-2 text-green-400";
                } else if (aqi <= 150) {
                     outsideRecommendationEl.textContent = "With Caution";
                    outsideRecommendationEl.className = "text-4xl font-bold mt-2 text-yellow-400";
                } else {
                    outsideRecommendationEl.textContent = "Not Recommended";
                    outsideRecommendationEl.className = "text-4xl font-bold mt-2 text-red-400";
                }
                
                let bestHour = -1;
                let lowestAqi = Infinity;
                hourlyAqi.slice(0, 24).forEach((val, index) => {
                    if (val < lowestAqi) {
                        lowestAqi = val;
                        bestHour = new Date(Date.now() + index * 3600000).getHours();
                    }
                });
                bestTimeEl.textContent = `${bestHour}:00`;
                sensitiveGroupAdviceEl.textContent = getAqiDetails(aqi).sensitive;
            }

            function updateEducationSection() {
                const data = educationData[activeCondition];
                const aqiLevel = currentAqiData.level;
                const riskInfo = data.riskMapping[aqiLevel] || data.riskMapping["Good"];
                
                conditionTitleEl.textContent = data.title;
                riskDescriptionEl.textContent = `Risk of symptoms is ${riskInfo.text.toLowerCase()} when AQI is ${aqiLevel}.`;
                symptomDescriptionEl.textContent = data.symptoms;
                
                riskLevelBadgeEl.textContent = riskInfo.text;
                riskLevelBadgeEl.className = `mt-4 px-3 py-1 rounded-full font-bold inline-block ${riskInfo.color}`;

                dosListEl.innerHTML = data.dos.map(item => `<li class="flex items-start gap-2"><svg class="w-4 h-4 text-green-400 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>${item}</li>`).join('');
                dontsListEl.innerHTML = data.donts.map(item => `<li class="flex items-start gap-2"><svg class="w-4 h-4 text-red-400 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"/></svg>${item}</li>`).join('');
            }

            async function updateDataPanel(city) {
                cityNameEl.textContent = city;
                aqiValueEl.textContent = '--';
                aqiLevelEl.textContent = 'Loading...';
                advisoryTextEl.textContent = 'Fetching real-time data...';
                
                const coords = cityData[city];
                if (!coords) return;
                
                updateClock(coords.timezone);

                const { lat, lon } = coords;
                const [airQuality, weatherData] = await Promise.all([
                    fetchAirQualityForecast(lat, lon),
                    fetchWeatherAndForecast(lat, lon)
                ]);
                
                if (!airQuality || !weatherData) return;

                const { currentAqi, hourlyAqi } = airQuality;
                
                const aqiDetails = getAqiDetails(currentAqi);
                currentAqiData = { aqi: currentAqi, level: aqiDetails.level };
                
                aqiValueEl.textContent = currentAqi;
                aqiLevelEl.textContent = aqiDetails.level;
                aqiValueEl.className = `text-8xl md:text-9xl font-black transition-colors ${aqiDetails.colorClass}`;
                aqiLevelEl.className = `text-2xl font-bold transition-colors ${aqiDetails.colorClass}`;
                
                advisoryTextEl.textContent = aqiDetails.advisory;
                
                updateWeatherUI(weatherData);
                updateActivityBriefing(currentAqi, weatherData, hourlyAqi);
                updateEducationSection();
            }

            // --- Populate and initialize ---
            Object.keys(cityData).forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                citySelect.appendChild(option);
            });
            
            updateDataPanel(citySelect.value);

            // --- Event Listeners ---
            citySelect.addEventListener('change', (e) => updateDataPanel(e.target.value));
            
            educationTabsContainer.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    document.querySelectorAll('.health-tab').forEach(tab => tab.classList.remove('active'));
                    e.target.classList.add('active');
                    activeCondition = e.target.dataset.condition;
                    updateEducationSection();
                }
            });
            
            document.querySelector('.health-tab[data-condition="copd"]').classList.add('active');
        });
    </script>
</body>
</html>

